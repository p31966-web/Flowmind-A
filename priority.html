<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FlowMind ‚Äî ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏á‡∏≤‡∏ô</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <div class="card">
    <h2>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥</h2>
    <div id="alertsContainer"></div>
    <div id="priorityList"></div>
    <div class="row" style="margin-top:10px">
      <button onclick="window.location.href='tasks.html'" class="btn secondary">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏á‡∏≤‡∏ô</button>
      <button onclick="window.location.href='schedule.html'" class="btn">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
    </div>
  </div>
</div>

<script>
function renderPriority(){
  const container=document.getElementById('priorityList');
  const alerts=document.getElementById('alertsContainer');
  container.innerHTML=''; alerts.innerHTML='';
  let tasks=JSON.parse(localStorage.getItem('flow_tasks')||'[]');
  if(!tasks.length){ container.innerHTML='<div class="small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</div>'; return; }
  tasks.sort((a,b)=> new Date(a.due)-new Date(b.due) || b.diff-a.diff);
  const now=Date.now();
  const ONE_DAY=24*60*60*1000, THREE_DAYS=3*ONE_DAY;
  let urgentCount=0, soonCount=0;
  tasks.forEach(t=>{
    const diffTime=new Date(t.due+'T23:59:59').getTime()-now;
    if(diffTime<=0 || diffTime<=ONE_DAY) urgentCount++;
    else if(diffTime<=THREE_DAYS) soonCount++;
  });
  if(urgentCount) alerts.innerHTML+=`<div class="notice">üî¥ ‡∏°‡∏µ ${urgentCount} ‡∏á‡∏≤‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>`;
  if(soonCount) alerts.innerHTML+=`<div class="notice" style="background:#fff7ed;border-color:#ffd8a8;color:#92400e">üü° ‡∏°‡∏µ ${soonCount} ‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô 3 ‡∏ß‡∏±‡∏ô</div>`;
  tasks.forEach((t,i)=>{
    const div=document.createElement('div');
    div.className='task-item';
    div.innerHTML=`<div><strong>${i+1}. ${t.title}</strong> ‚Äî ${t.subject}<br><span class="small">‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î: ${t.due} | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ${t.diff}</span></div>
    <div><button onclick="markDone(${i})" class="btn" style="background:#16a34a">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
    <button onclick="deleteTask(${i})" class="btn" style="background:#ef4444">‡∏•‡∏ö</button></div>`;
    container.appendChild(div);
  });
}

function markDone(i){
  let tasks=JSON.parse(localStorage.getItem('flow_tasks')||'[]');
  tasks.splice(i,1);
  localStorage.setItem('flow_tasks',JSON.stringify(tasks));
  renderPriority();
}
function deleteTask(i){ markDone(i); }

renderPriority();
</script>
</body>
</html>

